{% extends 'base.html' %}

{% block title %}Sensor Uitlezingen{% endblock %}

{% block head %}
<style>
  .sensor-table {
    border-collapse: collapse;
    width: 100%;
    max-width: 600px;
    margin: 1rem auto;
  }
  .sensor-table th, .sensor-table td {
    border: 1px solid #ccc;
    padding: 0.5rem;
    text-align: center;
  }
  .sensor-table th {
    background-color: #007bff;
    color: white;
  }
  .sensor-table tbody tr:nth-child(even) {
    background-color: #f9f9f9;
  }
</style>
{% endblock %}

{% block content %}
  <h1>Sensor Uitlezingen</h1>
  <table id="sensorTable" class="sensor-table">
    <thead>
      <tr>
        <th>Kanaal</th>
        <th>Ruwe Waarde</th>
        <th>Gekalibreerd</th>
      </tr>
    </thead>
    <tbody>
      {# Maak 4 lege rijen voor kanaal 0‚Äì3 #}
      {% for ch in range(4) %}
      <tr>
        <td>{{ ch }}</td>
        <td id="raw-{{ ch }}">‚Äì</td>
        <td id="val-{{ ch }}">‚Äì</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
<script>
  // Verbind met de /sensors namespace
  const socket = io('/sensors');

  socket.on('connect', () => {
    console.log('‚úÖ WebSocket verbonden (namespace /sensors)');
  });

  socket.on('sensor_update', readings => {
    console.log('üîî sensor_update ontvangen:', readings);
    readings.forEach(r => {
      const rawCell = document.getElementById(`raw-${r.channel}`);
      const valCell = document.getElementById(`val-${r.channel}`);
      if (rawCell) rawCell.textContent = r.raw;
      if (valCell) valCell.textContent = r.value.toFixed(2);
    });
  });

  socket.on('disconnect', () => {
    console.warn('‚ùå WebSocket verbinding verbroken');
  });
</script>
{% endblock %}
