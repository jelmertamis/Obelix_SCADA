<!-- templates/sbr.html -->
{% extends 'base.html' %}

{% block title %}SBR Configuratie & Status{% endblock %}

{% block head %}
<style>
  section.sbr-config {
    display: flex; flex-direction: column; align-items: center;
    padding: 1rem; width: 100%;
  }
  .sbr-phase-list {
    width: 100%; max-width: 700px; margin-top: 1rem;
    display: flex; flex-direction: column; gap: 0.75rem;
  }
  .phase-box {
    display: grid;
    grid-template-columns:
      2fr /* Naam */
      1fr /* Criterium */
      1fr /* Actueel */
      1fr /* Doel */
      2fr /* Invoer + knop */;
    align-items: center;
    background: #f9f9f9;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    gap: 0.5rem;
    transition: background 0.3s;
  }
  .phase-box.active { background: #28a745; color: #fff; }
  section.sbr-config.paused .phase-box.active {
    background: #ffc107; color: #333;
  }
  .phase-name { font-weight: bold; }
  .phase-criterion,
  .phase-actual,
  .phase-target { text-align: center; }
  .phase-input {
    width: 4rem; padding: 0.3rem; margin-right: 0.5rem;
    border: 1px solid #ccc; border-radius: 0.25rem;
  }
  .phase-set-btn {
    padding: 0.7rem 1rem; border: none; border-radius: 0.25rem;
    background: #007bff; color: #fff; cursor: pointer;
  }
  .phase-set-btn:hover { background: #0056b3; }
  .control_button {
    padding: 1.2rem 1rem; border: none; border-radius: 0.25rem;
    background: #007bff; color: #fff; cursor: pointer;
    font-size: 1.2rem;
    font-weight: bold;
  }
  .control_button:hover { background: #0056b3; }
</style>
{% endblock %}

{% block content %}
<section class="sbr-config" id="sbr-config-section">
  <h1>SBR Configuratie & Status</h1>

  <div id="cycle-timer" style="font-size:1.2rem; margin-bottom:0.5rem;">
    Cyclus: 00:00
  </div>
  <div style="margin-bottom:1rem;">
    <button id="btn-toggle" class="control_button">Start Cycle</button>
    <button id="btn-reset"  class="control_button">Reset Cycle</button>

    <p id="cycle-max-display" style="margin:0.5rem 0; font-weight:bold;">
      Huidige limiet: <span id="cycle-max-text">--</span> min
    </p>
    <p id="heat-set-display" style="margin:0.5rem 0; font-weight:bold;">
      Heat ON: <span id="heat-on-text">--</span> 째C, Heat OFF: <span id="heat-off-text">--</span> 째C
    </p>

    <!-- Nieuw: Max Cycle Time instellen -->
    <label style="font-size:1rem; margin:0 0 0 1rem;">
      Max Cycle Time (min):
      <input type="number" id="cycle-max-input" min="0" step="1" value="" style="width:4em; padding:0.3rem; border:1px solid #ccc; border-radius:0.25rem;">
    </label>
    <button id="btn-set-cycle-max" class="phase-set-btn">Set</button>
    
    <!-- Nieuw: Heating Valve setpoints instellen -->
    <label style="font-size:1rem; margin:0 1rem 0 0;">
      Heat ON (째C):
      <input type="number" id="heat-on-input" min="0" step="0.1" value="" style="width:4em; padding:0.3rem; border:1px solid #ccc; border-radius:0.25rem;">
    </label>
    <label style="font-size:1rem; margin-right:1rem;">
      Heat OFF (째C):
      <input type="number" id="heat-off-input" min="0" step="0.1" value="" style="width:4em; padding:0.3rem; border:1px solid #ccc; border-radius:0.25rem;">
    </label>
    <button id="btn-set-heat" class="phase-set-btn">Set Heat</button>
  
  </div>
  
  <div class="sbr-phase-list">
    {% for key,label in [
         ('influent','Influent'),
         ('react','React'),
         ('effluent','Effluent'),
         ('wait','Wait'),
         ('dose_nutrients', 'Dose nutrients'),
         ('wait_after_N', 'Wait after N')
       ] %}
    <div class="phase-box" id="phase-{{ key }}-box">
      <div class="phase-name">{{ label }}</div>
      <div class="phase-criterion">
        {% if key in ['influent', 'effluent'] %}
          Level
        {% else %}
          Time
        {% endif %}
      </div>
      <div class="phase-actual" id="{{ key }}-actual">--</div>
      <div class="phase-target" id="{{ key }}-target">--</div>
      <div>
        <input
          type="number" step="0.1" min="0"
          class="phase-input"
          id="{{ key }}-input"
          placeholder="{% if key in ['influent','effluent'] %}Set level{% else %}min{% endif %}"
        >
        <button class="phase-set-btn" id="btn-set-{{ key }}">Set</button>
      </div>
    </div>
    {% endfor %}
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
<script src="{{ url_for('static', filename='js/sbr.js') }}"></script>
{% endblock %}
